<!doctype html>
<html>
  <head>
    <title>learningthree.js boiler plate for three.js</title>
    <meta charset="utf-8">

    <script src="vendor/three.js/Three.js"></script>
    <script src="vendor/three.js/Detector.js"></script>
    <script src="vendor/three.js/Stats.js"></script>

    <script src="vendor/jquery-1.7.1.min.js"></script>
    <script src="vendor/Tween.js"></script>
    <script src="vendor/underscore-min.js"></script>
    <script src="vendor/mustache.min.js"></script>

    <script src="src/puppet.js"></script>

    <link  href="css/main.css" rel="stylesheet"/>
  </head>
  <body>
    <!-- three.js container -->
    <div id="container"></div>

    <script type="text/javascript">
      var stats, scene, renderer, camera;

      if (!init()) {
        TWEEN.start();
        animate();
      }

      // init the scene
      function init(){
        setupEnv();
        setupModel();
      }

      // camera
      var lastX, lastY, isDragging;
      document.addEventListener('mousedown', function(event) {
        isDragging = true;
        lastX = event.clientX;
        lastY = event.clientY;
      });
      document.addEventListener('mousemove', function(event) {
        if (isDragging) {
          var s = 2;

          camera.position.x += (event.clientX - lastX) / window.innerWidth * s;
          camera.position.y += (event.clientY - lastY) / window.innerHeight * s;

          camera.lookAt(scene.position);
        }
			});
      document.addEventListener('mouseup', function(event) {
        isDragging = false;
      });

      // animation loop
      function animate() {
        // loop on request animation loop
        // - it has to be at the begining of the function
        // - see details at http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
        requestAnimationFrame(animate);

        // do the render
        render();

        // update stats
        stats.update();
      }

      // render the scene
      function render() {
        // actually render the scene
        renderer.render(scene, camera);
      }

      //
      // setuppers
      //
      function setupEnv() {
        if (Detector.webgl) {
          renderer = new THREE.WebGLRenderer({
            antialias: true,	// to get smoother output
            preserveDrawingBuffer: true	// to allow screenshot
          });
          renderer.setClearColorHex(0xBBBBBB, 1);
        // uncomment if webgl is required
        }else{
        	Detector.addGetWebGLMessage();
        	throw new Error('we need webgl');
        }
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);

        // add Stats.js - https://github.com/mrdoob/stats.js
        stats = new Stats();
        stats.domElement.style.position	= 'absolute';
        stats.domElement.style.bottom	= '0px';
        document.body.appendChild(stats.domElement);

        // create a scene
        scene = new THREE.Scene();

        // put a camera in the scene
        camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 10000);
        camera.position.set(0, 5, 5);
        camera.lookAt(new THREE.Vector3());
        scene.add(camera);

        // Light
				var directionalLight = new THREE.DirectionalLight(0xffeedd);
				directionalLight.position.set(0, -70, 100).normalize();
				scene.add(directionalLight);
      }

      function setupModel() {
				var loader = new THREE.JSONLoader(),
            model = {

              "metadata" :
              {
                "formatVersion" : 3,
                "vertices"      : 8,
                "faces"         : 6,
                "normals"       : 0,
                "colors"        : 22,
                "uvs"           : 0,
                "materials"     : 1,
                "morphTargets"  : 0
              },

              //"scale" : 1.000000,

              "materials": [	{
                "DbgColor" : 15658734,
                "DbgIndex" : 0,
                "DbgName" : "Material",
                "colorAmbient" : [0, 0, 0],
                "colorDiffuse" : [0.800000011920929, 0.800000011920929, 0.800000011920929],
                "colorSpecular" : [0.5, 0.5, 0.5],
                "shading" : "Lambert",
                "specularCoef" : 50,
                "vertexColors" : true
              }],

              "vertices": [1.000000,-1.000000,-1.000000,1.000000,-1.000000,1.000000,-1.000000,-1.000000,1.000000,-1.000000,-1.000000,-1.000000,1.000000,1.000000,-1.000000,0.999999,1.000000,1.000001,-1.000000,1.000000,1.000000,-1.000000,1.000000,-1.000000],

              "morphTargets": [],

              "normals": [],

              "colors": [16777215,16769421,16769424,8454135,15195931,7299839,16586715,16711687,1056014,6029475,13762484,9044089,7962349,6772991,16774622,4144383,11973887,1966063,1056285,9081232,13696943,5002581],

              "uvs": [[]],

              "faces": [131,0,1,2,3,0,0,1,2,3,131,4,7,6,5,0,4,5,6,7,131,0,4,5,1,0,0,8,9,10,131,1,5,6,2,0,0,11,12,13,131,2,6,7,3,0,14,15,16,17,131,4,0,3,7,0,18,19,20,21]
            };

				loader.createModel(model, 
            function(geometry) {
            var mesh = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial()),
                s = 1;

            mesh.scale.set(s, s, s);
            scene.add(mesh);
        }, '');
      }

    </script>
  </body>
</html>
